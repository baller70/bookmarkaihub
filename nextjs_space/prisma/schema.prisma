generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// NextAuth tables
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String?
  emailVerified DateTime?
  image         String?
  fullName      String?
  isAdmin       Boolean   @default(false)
  customLogo    String?   @db.Text // S3 cloud storage path for global custom logo
  goalsViewLogo String?   @db.Text // S3 cloud storage path for Goals view global logo
  subscriptionTier  SubscriptionTier @default(BASIC)
  
  accounts      Account[]
  sessions      Session[]
  bookmarks     Bookmark[]
  categories    Category[]
  categoryFolders CategoryFolder[]
  tags          Tag[]
  analytics     Analytics[]
  goals         Goal[]
  goalFolders   GoalFolder[]
  dnaProfile    DNAProfile?
  playbooks     Playbook[]
  searchHistory SearchHistory[]
  timeCapsules  TimeCapsule[]
  ownedCompanies    Company[] @relation("CompanyOwner")
  companies         UserCompany[]
  bulkUploadLogs    BulkUploadLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum SubscriptionTier {
  BASIC
  PRO
  ELITE
}

model Company {
  id                      String    @id @default(cuid())
  name                    String
  logo                    String?   @db.Text
  description             String?   @db.Text
  ownerId                 String
  owner                   User      @relation("CompanyOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members                 UserCompany[]
  bookmarks               Bookmark[]
  categories              Category[]
  goals                   Goal[]
  goalFolders             GoalFolder[]
  todoItems               TodoItem[]
  taskLists               TaskList[]
  quickNotes              QuickNote[]
  habits                  Habit[]
  comments                BookmarkComment[]
  media                   Media[]
  mediaFolders            MediaFolder[]
  notificationSchedules   NotificationSchedule[]
  notificationPreferences NotificationPreference[]
  timerSettings           TimerSettings[]
  timerQueues             TimerQueue[]
  bulkUploadLogs          BulkUploadLog[]
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  @@unique([ownerId, name])
}

model UserCompany {
  id        String   @id @default(cuid())
  userId    String
  companyId String
  role      String   @default("member")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, companyId])
}

// Core bookmark management
model Bookmark {
  id          String   @id @default(cuid())
  title       String
  url         String   @db.Text
  description String?  @db.Text
  favicon     String?  @db.Text
  priority    Priority @default(MEDIUM)
  isFavorite  Boolean  @default(false)
  
  // Custom branding (Grid View only)
  customFavicon    String? @db.Text // S3 cloud storage path for custom favicon
  customLogo       String? @db.Text // S3 cloud storage path for custom logo overlay
  subscriptionTier  SubscriptionTier @default(BASIC)
  customBackground String? @db.Text // S3 cloud storage path for custom background
  
  // Usage tracking
  totalVisits      Int      @default(0)
  engagementScore  Int      @default(0)
  timeSpent        Int      @default(0) // in seconds (for granular tracking)
  usagePercentage  Float    @default(0)
  lastVisited      DateTime?
  
  // Task management
  openTasks      Int @default(0)
  completedTasks Int @default(0)
  totalTasks     Int @default(0)
  
  // Relationships
  userId       String
  user         User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyId    String?
  company      Company?            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  folderId     String?
  folder       BookmarkFolder?     @relation(fields: [folderId], references: [id], onDelete: SetNull)
  categories   BookmarkCategory[]
  tags         BookmarkTag[]
  tasks        Task[]
  notes        Note[]
  history      BookmarkHistory[]
  playbookItems PlaybookItem[]
  goals        GoalBookmark[]
  
  // Customizable tools
  toolPreferences BookmarkToolPreference[]
  todoItems       TodoItem[]
  quickNotes      QuickNote[]
  habits          Habit[]
  taskLists       TaskList[]
  timerQueue      TimerQueue[]
  timerSettings   TimerSettings?
  
  // Notification system
  notificationSchedules NotificationSchedule[]
  notificationPreference NotificationPreference?
  notificationTeam NotificationTeam[]
  
  // Media system
  media           Media[]
  mediaFolders    MediaFolder[]
  
  // Comments system
  comments        BookmarkComment[]
  
  // Related bookmarks
  relatedFrom     RelatedBookmark[] @relation("BookmarkRelations")
  relatedTo       RelatedBookmark[] @relation("RelatedBookmarks")
  
  // New tools (Phase 1 & 2)
  readingProgress   ReadingProgress[]
  codeSnippets      CodeSnippet[]
  webHighlights     WebHighlight[]
  aiSummaries       AISummary[]
  versionSnapshots  VersionSnapshot[]
  priceTracker      PriceTracker[]
  relatedResources  RelatedResource[]
  shares            BookmarkShare[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, createdAt])
  @@index([userId, priority])
  @@index([folderId])
}

// Bookmark subfolders within a category
model BookmarkFolder {
  id         String    @id @default(cuid())
  name       String
  color      String?   @default("#3B82F6") // Folder color
  categoryId String
  userId     String
  companyId  String?
  bookmarks  Bookmark[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([categoryId, userId])
  @@index([userId])
}

model Category {
  id              String    @id @default(cuid())
  name            String
  description     String?
  color           String?   // Optional folder outline color
  backgroundColor String?   // Optional folder background color
  icon            String    @default("folder")
  logo            String?   // Custom logo image URL (S3 path)

  userId      String
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyId    String?
  company      Company?            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  bookmarks   BookmarkCategory[]

  folderId    String?
  folder      CategoryFolder?     @relation(fields: [folderId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, name])
  @@index([userId, createdAt])  // Performance index for listing user's categories
  @@index([companyId])          // Performance index for company lookups
}

model CategoryFolder {
  id          String     @id @default(cuid())
  name        String
  
  userId      String
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  categories  Category[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, name])
}

model Tag {
  id        String       @id @default(cuid())
  name      String
  color     String       @default("#10B981") // Green default

  userId    String
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  bookmarks BookmarkTag[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, name])
  @@index([userId, createdAt]) // Performance index for listing user's tags
}

// Junction tables for many-to-many relationships
model BookmarkCategory {
  id         String   @id @default(cuid())
  bookmarkId String
  categoryId String

  bookmark   Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([bookmarkId, categoryId])
  @@index([bookmarkId])  // Performance index for bookmark lookups
  @@index([categoryId])  // Performance index for category lookups
}

model BookmarkTag {
  id         String   @id @default(cuid())
  bookmarkId String
  tagId      String

  bookmark   Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  tag        Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([bookmarkId, tagId])
  @@index([bookmarkId])  // Performance index for bookmark lookups
  @@index([tagId])       // Performance index for tag lookups
}

// Task management
model Task {
  id          String     @id @default(cuid())
  title       String
  description String?    @db.Text
  status      TaskStatus @default(OPEN)
  priority    Priority   @default(MEDIUM)
  dueDate     DateTime?
  
  bookmarkId  String
  bookmark    Bookmark   @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  // Pomodoro tracking
  pomodoroSessions Int @default(0)
  timeSpent        Int @default(0) // in minutes

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  completedAt DateTime?
}

// Notes system
model Note {
  id         String  @id @default(cuid())
  content    String  @db.Text
  bookmarkId String
  bookmark   Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Analytics and usage tracking
model Analytics {
  id     String @id @default(cuid())
  date   DateTime @db.Date
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Daily metrics
  totalVisits     Int @default(0)
  engagementScore Int @default(0)
  bookmarksAdded  Int @default(0)
  bookmarksViewed Int @default(0)
  timeSpent       Int @default(0) // in minutes

  @@unique([userId, date])
}

// Bookmark history/activity log
model BookmarkHistory {
  id         String           @id @default(cuid())
  action     BookmarkAction
  details    String?          @db.Text
  bookmarkId String
  bookmark   Bookmark         @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
}

// Goal system (Goals)
model GoalFolder {
  id          String   @id @default(cuid())
  name        String
  description String?  @db.Text
  color       String   @default("#3B82F6") // Blue default
  logo        String?  @db.Text // Per-folder custom logo
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)
  goals       Goal[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, name])
}

model Goal {
  id          String     @id @default(cuid())
  title       String
  description String?    @db.Text
  goalType    String     @default("Custom") // Custom, Learning, Project, Health, etc.
  color       String     @default("#3b82f6") // Hex color
  logo        String?    @db.Text // Per-goal custom logo
  priority    Priority   @default(MEDIUM)
  status      GoalStatus @default(NOT_STARTED)
  deadline    DateTime?
  progress    Float      @default(0) // 0-100
  tags        String[]   @default([]) // Array of tag strings
  notes       String?    @db.Text
  
  userId      String
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  folderId    String?
  folder      GoalFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)
  
  bookmarks   GoalBookmark[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  completedAt DateTime?
}

model GoalBookmark {
  id         String   @id @default(cuid())
  goalId     String
  bookmarkId String
  
  goal       Goal     @relation(fields: [goalId], references: [id], onDelete: Cascade)
  bookmark   Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)

  @@unique([goalId, bookmarkId])
}

model RelatedBookmark {
  id                  String   @id @default(cuid())
  bookmarkId          String
  relatedBookmarkId   String
  
  bookmark            Bookmark @relation("BookmarkRelations", fields: [bookmarkId], references: [id], onDelete: Cascade)
  relatedBookmark     Bookmark @relation("RelatedBookmarks", fields: [relatedBookmarkId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([bookmarkId, relatedBookmarkId])
  @@index([bookmarkId])
  @@index([relatedBookmarkId])
}

// Enums
enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum BookmarkAction {
  CREATED
  VIEWED
  UPDATED
  DELETED
  TAGGED
  CATEGORIZED
  SHARED
}

enum GoalStatus {
  NOT_STARTED
  IN_PROGRESS
  ACTIVE
  COMPLETED
  PAUSED
  CANCELLED
}

// DNA Profile System
model DNAProfile {
  id             String   @id @default(cuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Basic Information
  avatar         String?  @db.Text
  fullName       String?
  organization   String?
  bio            String?  @db.Text
  
  // Industry & Preferences
  favoriteIndustry    String?
  favoriteIndustry2   String?
  linkSourcePref      String?
  languagePref        String?
  mediaFormatPriority String?
  contentFreshness    String?
  sourceCredibility   String?
  primaryUseCase      String?
  
  // Links & Social
  website    String?
  linkedin   String?
  twitter    String?
  tiktok     String?
  instagram  String?
  facebook   String?
  
  // Interests & Skills (JSON arrays)
  subIndustrySkills Json? // string[]
  skillsExpertise   Json? // string[]
  personalInterests Json? // string[]
  
  // Learning Preferences
  learningStyle        String?
  contentDepthPref     String?
  timeCommitment       String?
  goalSettingStyle     String?
  
  // Privacy & Preferences
  profileVisibility    String? @default("private")
  notificationFreq     String? @default("daily")
  showActivity         Boolean @default(true)
  allowRecommendations Boolean @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Playbook {
  id          String         @id @default(cuid())
  title       String
  description String?        @db.Text
  category    String?
  isActive    Boolean        @default(false)
  duration    Int            @default(0) // total duration in seconds
  
  userId      String
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items       PlaybookItem[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PlaybookItem {
  id          String   @id @default(cuid())
  order       Int
  duration    Int      @default(300) // duration in seconds (default 5 min)
  
  bookmarkId  String
  bookmark    Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  playbookId  String
  playbook    Playbook @relation(fields: [playbookId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([playbookId, bookmarkId])
}

model SearchHistory {
  id       String   @id @default(cuid())
  query    String
  filters  Json?    // Store filter options as JSON
  results  Int      @default(0)
  
  userId   String
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}

model TimeCapsule {
  id          String   @id @default(cuid())
  title       String
  description String?  @db.Text
  date        DateTime @db.Date
  
  // Snapshot stats
  totalBookmarks Int @default(0)
  totalFolders   Int @default(0)
  totalSize      Int @default(0) // in KB
  
  // Snapshot data (JSON)
  snapshot    Json     // Complete snapshot of bookmarks, categories, etc.
  aiSummary   String?  @db.Text
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ViewMode {
  GRID
  LIST
  COMPACT
  TABLE
}

// Customizable Tools System
model BookmarkTool {
  id          String   @id @default(cuid())
  key         String   @unique // overview, arp, notification, task, media, comment, todo, notes, habits
  label       String   // Display name
  icon        String   // Icon name for Lucide
  isDefault   Boolean  @default(false) // Default tools that ship with all bookmarks
  isSystem    Boolean  @default(false) // Cannot be deleted (overview, arp, etc.)
  
  preferences BookmarkToolPreference[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BookmarkToolPreference {
  id         String   @id @default(cuid())
  bookmarkId String
  toolKey    String
  isEnabled  Boolean  @default(true)
  order      Int      @default(0) // For custom ordering of tabs
  
  bookmark   Bookmark     @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  tool       BookmarkTool @relation(fields: [toolKey], references: [key], onDelete: Cascade)
  
  @@unique([bookmarkId, toolKey])
}

// To-Do List Tool
model TodoItem {
  id          String   @id @default(cuid())
  bookmarkId  String
  title       String
  description String?  @db.Text
  completed   Boolean  @default(false)
  priority    TodoPriority @default(MEDIUM)
  dueDate     DateTime?
  order       Int      @default(0)
  
  bookmark      Bookmark       @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  listItems     TaskListItem[]
  timerQueue    TimerQueue[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  completedAt DateTime?
}

enum TodoPriority {
  LOW
  MEDIUM
  HIGH
}

// Quick Notes Tool (Rich text notes)
model QuickNote {
  id          String   @id @default(cuid())
  bookmarkId  String
  title       String?
  content     String   @db.Text // Can store markdown or HTML
  
  bookmark    Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Habit Tracker Tool
model Habit {
  id          String   @id @default(cuid())
  bookmarkId  String
  name        String
  description String?  @db.Text
  color       String   @default("#3B82F6") // Hex color for visualization
  frequency   HabitFrequency @default(DAILY)
  targetCount Int      @default(1) // How many times per period
  isActive    Boolean  @default(true)
  
  bookmark    Bookmark      @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  checkins    HabitCheckIn[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model HabitCheckIn {
  id          String   @id @default(cuid())
  habitId     String
  date        DateTime @db.Date // Date of check-in
  completed   Boolean  @default(true)
  count       Int      @default(1) // Number of times completed on this date
  note        String?  @db.Text
  
  habit       Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([habitId, date])
}

enum HabitFrequency {
  DAILY
  WEEKLY
  MONTHLY
}

// Task Lists System
model TaskList {
  id          String   @id @default(cuid())
  bookmarkId  String
  name        String
  description String?  @db.Text
  color       String   @default("#3B82F6") // Hex color
  order       Int      @default(0)
  
  bookmark    Bookmark         @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  items       TaskListItem[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TaskListItem {
  id          String   @id @default(cuid())
  taskListId  String
  todoItemId  String
  order       Int      @default(0)
  
  taskList    TaskList @relation(fields: [taskListId], references: [id], onDelete: Cascade)
  todoItem    TodoItem @relation(fields: [todoItemId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([taskListId, todoItemId])
}

// Timer System
model TimerQueue {
  id          String   @id @default(cuid())
  bookmarkId  String
  todoItemId  String?  // If null, it's a break/rest period
  order       Int      @default(0)
  duration    Int      @default(1500) // Duration in seconds (default 25 min = 1500s)
  isBreak     Boolean  @default(false)
  completed   Boolean  @default(false)
  
  bookmark    Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  todoItem    TodoItem? @relation(fields: [todoItemId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@index([bookmarkId, order])
}

model TimerSettings {
  id                String   @id @default(cuid())
  bookmarkId        String   @unique
  isEnabled         Boolean  @default(true)
  workDuration      Int      @default(1500) // 25 minutes in seconds
  shortBreak        Int      @default(300)  // 5 minutes
  longBreak         Int      @default(900)  // 15 minutes
  autoStartBreaks   Boolean  @default(false)
  autoStartPomodoros Boolean @default(false)
  soundEnabled      Boolean  @default(true)
  
  bookmark    Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Notification System
model NotificationSchedule {
  id          String   @id @default(cuid())
  bookmarkId  String
  title       String
  description String?  @db.Text
  reminderDate DateTime
  reminderTime String   // HH:MM format
  frequency   NotificationFrequency @default(ONCE)
  isActive    Boolean  @default(true)
  notifyVia   String[] @default(["app"]) // app, email, sms
  
  bookmark    Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  history     NotificationHistory[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model NotificationPreference {
  id          String   @id @default(cuid())
  bookmarkId  String   @unique
  
  // Email preferences
  emailEnabled       Boolean @default(true)
  emailDaily         Boolean @default(false)
  emailWeekly        Boolean @default(true)
  emailImportant     Boolean @default(true)
  
  // App preferences
  appPush            Boolean @default(true)
  appReminders       Boolean @default(true)
  appUpdates         Boolean @default(true)
  
  // SMS preferences (premium)
  smsEnabled         Boolean @default(false)
  smsImportantOnly   Boolean @default(true)
  
  // Quiet hours
  quietHoursEnabled  Boolean @default(false)
  quietHoursStart    String? // HH:MM format
  quietHoursEnd      String? // HH:MM format
  
  bookmark    Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model NotificationHistory {
  id          String   @id @default(cuid())
  scheduleId  String
  sentAt      DateTime @default(now())
  status      NotificationStatus @default(SENT)
  sentVia     String   @default("app") // app, email, sms
  errorMessage String? @db.Text
  
  schedule    NotificationSchedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}

model NotificationTeam {
  id          String   @id @default(cuid())
  bookmarkId  String
  memberEmail String
  memberName  String?
  role        TeamRole @default(VIEWER)
  canEdit     Boolean  @default(false)
  canDelete   Boolean  @default(false)
  
  bookmark    Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([bookmarkId, memberEmail])
}

enum NotificationFrequency {
  ONCE
  DAILY
  WEEKLY
  MONTHLY
  CUSTOM
}

enum NotificationStatus {
  SENT
  PENDING
  FAILED
  CANCELLED
}

enum TeamRole {
  OWNER
  ADMIN
  EDITOR
  VIEWER
}

// Media System
model Media {
  id          String   @id @default(cuid())
  bookmarkId  String
  folderId    String?
  
  fileName    String
  originalName String
  fileType    MediaType
  fileSize    Int      // in bytes
  mimeType    String
  cloudStoragePath String @db.Text // S3 key or cloud storage path
  thumbnailPath String? @db.Text // For images/videos
  
  // Metadata
  width       Int?     // For images/videos
  height      Int?     // For images/videos
  duration    Int?     // For audio/videos (in seconds)
  
  // Organization
  tags        String[] @default([])
  description String?  @db.Text
  
  bookmark    Bookmark      @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  folder      MediaFolder?  @relation(fields: [folderId], references: [id], onDelete: SetNull)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([bookmarkId, fileType])
}

model MediaFolder {
  id          String   @id @default(cuid())
  bookmarkId  String
  name        String
  color       String   @default("#3B82F6")
  parentId    String?
  
  bookmark    Bookmark      @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  parent      MediaFolder?  @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    MediaFolder[] @relation("FolderHierarchy")
  media       Media[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([bookmarkId, name])
}

enum MediaType {
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  OTHER
}

// Comments System
model BookmarkComment {
  id          String   @id @default(cuid())
  bookmarkId  String
  userId      String   // Author of the comment
  content     String   @db.Text
  isResolved  Boolean  @default(false)
  isPinned    Boolean  @default(false)
  
  // Metadata
  tags        String[] @default([])
  
  bookmark    Bookmark          @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  companyId   String?
  company     Company?          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  replies     CommentReply[]
  mentions    CommentMention[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([bookmarkId, createdAt])
}

model CommentReply {
  id          String   @id @default(cuid())
  commentId   String
  userId      String   // Author of the reply
  content     String   @db.Text
  
  comment     BookmarkComment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  mentions    CommentMention[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CommentMention {
  id          String   @id @default(cuid())
  commentId   String?
  replyId     String?
  mentionedUserId String // User being mentioned
  
  comment     BookmarkComment? @relation(fields: [commentId], references: [id], onDelete: Cascade)
  reply       CommentReply?    @relation(fields: [replyId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
}

// Marketplace System
model MarketplaceCategory {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?  @db.Text
  icon        String   @default("folder")
  
  bundles     MarketplaceBundle[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MarketplaceBundle {
  id          String   @id @default(cuid())
  title       String
  description String   @db.Text
  coverImage  String?  @db.Text // S3 cloud storage path
  price       Float    @default(0) // 0 = free
  categoryId  String?
  tags        String[] @default([])
  
  // Stats
  viewCount     Int @default(0)
  purchaseCount Int @default(0)
  averageRating Float @default(0)
  
  // Relations
  sellerId    String
  category    MarketplaceCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  items       MarketplaceBundleItem[]
  purchases   MarketplacePurchase[]
  reviews     MarketplaceReview[]
  
  isActive    Boolean @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([sellerId, createdAt])
  @@index([categoryId])
}

model MarketplaceBundleItem {
  id          String   @id @default(cuid())
  bundleId    String
  bookmarkId  String
  order       Int      @default(0)
  
  bundle      MarketplaceBundle @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([bundleId, bookmarkId])
  @@index([bundleId, order])
}

model MarketplacePurchase {
  id              String   @id @default(cuid())
  bundleId        String
  buyerId         String
  sellerId        String
  amount          Float
  stripePaymentId String?  @db.Text
  
  bundle          MarketplaceBundle @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  
  purchasedAt DateTime @default(now())
  
  @@index([buyerId, purchasedAt])
  @@index([sellerId, purchasedAt])
  @@index([bundleId])
}

model MarketplaceReview {
  id          String   @id @default(cuid())
  bundleId    String
  userId      String
  rating      Int      // 1-5 stars
  reviewText  String?  @db.Text
  
  bundle      MarketplaceBundle @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  upvotes     MarketplaceReviewUpvote[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([bundleId, userId])
  @@index([bundleId, createdAt])
}

model MarketplaceReviewUpvote {
  id          String   @id @default(cuid())
  reviewId    String
  userId      String
  
  review      MarketplaceReview @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([reviewId, userId])
  @@index([reviewId])
}

model MarketplaceBadge {
  id          String   @id @default(cuid())
  userId      String   @unique
  badgeLevel  BadgeLevel @default(BRONZE)
  
  // Stats for badge calculation
  totalSales      Int @default(0)
  totalRevenue    Float @default(0)
  averageRating   Float @default(0)
  totalReviews    Int @default(0)
  totalUpvotes    Int @default(0)
  qualityScore    Float @default(0) // Calculated metric
  
  earnedAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([badgeLevel])
  @@index([qualityScore])
}

enum BadgeLevel {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
}

// ============================================
// NEW BOOKMARK TOOLS (Phase 1 & 2)
// ============================================

// 1. Reading Progress Tracker (PRO tier)
model ReadingProgress {
  id                String    @id @default(cuid())
  bookmarkId        String
  userId            String
  scrollPosition    Float     @default(0) // Percentage 0-100
  currentSection    String?   @db.Text
  estimatedTimeLeft Int       @default(0) // in minutes
  totalSections     Int       @default(1)
  completedSections Int       @default(0)
  lastReadAt        DateTime  @default(now())
  
  bookmark          Bookmark  @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([bookmarkId, userId])
  @@index([bookmarkId])
  @@index([userId, lastReadAt])
}

// 2. Code Snippets Manager (PRO tier)
model CodeSnippet {
  id          String   @id @default(cuid())
  bookmarkId  String
  userId      String
  title       String
  code        String   @db.Text
  language    String   @default("javascript") // javascript, python, etc.
  description String?  @db.Text
  tags        String[] // Array of tags
  lineNumber  Int?     // Reference line in original content
  
  bookmark    Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([bookmarkId])
  @@index([userId, createdAt])
  @@index([language])
}

// 3. Web Clipper & Highlights (ELITE tier)
model WebHighlight {
  id              String   @id @default(cuid())
  bookmarkId      String
  userId          String
  highlightedText String   @db.Text
  context         String?  @db.Text // Surrounding text for context
  personalNote    String?  @db.Text
  color           String   @default("#FCD34D") // Yellow default
  tags            String[] // Array of tags
  position        Int?     // Position in document
  
  bookmark        Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([bookmarkId])
  @@index([userId, createdAt])
}

// 4. AI Summary & Insights (ELITE tier)
model AISummary {
  id                String   @id @default(cuid())
  bookmarkId        String
  userId            String
  summaryType       SummaryType @default(TLDR)
  content           String   @db.Text
  keyPoints         String[] // Array of key points
  actionItems       String[] // Array of action items
  discussionQuestions String[] // Array of questions
  generatedAt       DateTime @default(now())
  
  bookmark          Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@index([bookmarkId])
  @@index([userId, generatedAt])
}

enum SummaryType {
  TLDR
  KEY_POINTS
  ACTION_ITEMS
  DISCUSSION_QUESTIONS
  FULL_SUMMARY
}

// 5. Version Monitor & Change Tracker (ELITE tier)
model VersionSnapshot {
  id              String   @id @default(cuid())
  bookmarkId      String
  userId          String
  snapshotContent String   @db.Text
  contentHash     String   // MD5 hash for change detection
  changesSummary  String?  @db.Text
  majorChange     Boolean  @default(false)
  diffSize        Int      @default(0) // Number of changed characters
  
  bookmark        Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@index([bookmarkId, createdAt])
  @@index([userId, majorChange])
}

// 6. Price & Availability Tracker (ELITE tier)
model PriceTracker {
  id                String   @id @default(cuid())
  bookmarkId        String
  userId            String
  currentPrice      Float
  originalPrice     Float
  currency          String   @default("USD")
  availability      AvailabilityStatus @default(IN_STOCK)
  priceHistory      Json     // Array of {date, price} objects
  lowestPrice       Float?
  highestPrice      Float?
  alertOnDrop       Boolean  @default(true)
  alertThreshold    Float?   // Alert when price drops below this
  
  bookmark          Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lastChecked DateTime @default(now())
  
  @@unique([bookmarkId, userId])
  @@index([bookmarkId])
  @@index([userId, alertOnDrop])
}

enum AvailabilityStatus {
  IN_STOCK
  OUT_OF_STOCK
  LIMITED
  DISCONTINUED
  UNKNOWN
}

// 7. Related Resources Finder (ELITE tier)
model RelatedResource {
  id               String   @id @default(cuid())
  bookmarkId       String
  userId           String
  resourceType     ResourceType @default(EXTERNAL)
  title            String
  url              String   @db.Text
  description      String?  @db.Text
  relevanceScore   Float    @default(0) // 0-1
  source           String?  // "ai_suggestion", "user_added", "web_search"
  
  bookmark         Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@index([bookmarkId])
  @@index([userId, relevanceScore])
}

enum ResourceType {
  INTERNAL // From user's own bookmarks
  EXTERNAL // From web search
  AI_SUGGESTED // AI-generated suggestions
}

// 8. Collaboration & Sharing (ELITE tier)
model BookmarkShare {
  id            String   @id @default(cuid())
  bookmarkId    String
  ownerId       String   // User who owns the bookmark
  sharedWithId  String   // User who receives access
  permission    SharePermission @default(VIEW)
  message       String?  @db.Text
  accessCount   Int      @default(0)
  lastAccessed  DateTime?
  expiresAt     DateTime?
  
  bookmark      Bookmark @relation(fields: [bookmarkId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([bookmarkId, sharedWithId])
  @@index([bookmarkId])
  @@index([sharedWithId])
  @@index([ownerId, createdAt])
}

enum SharePermission {
  VIEW
  COMMENT
  EDIT
}

// Bulk Upload History Log
model BulkUploadLog {
  id              String   @id @default(cuid())
  userId          String
  companyId       String?
  
  // Upload Details
  totalLinks      Int
  successCount    Int      @default(0)
  failedCount     Int      @default(0)
  duplicateCount  Int      @default(0)
  skippedCount    Int      @default(0)
  
  // Upload Settings (JSON)
  settings        Json?    // Stores all the settings used for this upload
  
  // Metadata
  source          String   @default("bulk_uploader") // bulk_uploader, paste_text, drag_drop, single_url
  importMethod    String?  // paste, file, single
  
  // Links data
  linksData       Json?    // Stores array of {url, status, error, domain, etc}
  
  // User reference
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  company         Company? @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  
  @@index([userId, createdAt])
  @@index([companyId, createdAt])
}
